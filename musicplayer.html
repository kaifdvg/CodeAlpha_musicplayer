<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Music Player</title>
  
  <style>
    :root{
      --bg: #0b1020;
      --panel: #151b34;
      --panel-2:#0f1430;
      --text: #eef2ff;
      --muted:#aab3d1;
      --brand: #6c9cff;
      --brand-2:#a96cff;
      --success:#22c55e;
      --danger:#ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 20px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% 10%, #1a2147 0%, #0b1020 45%),
                  radial-gradient(800px 600px at 90% 80%, #1a1038 0%, #0b1020 60%);
      color:var(--text);
      display:grid; place-items:center; padding:24px;
    }

    .player{
      width:min(950px, 95vw);
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:grid; grid-template-columns: 320px 1fr; min-height: 540px;
      border:1px solid rgba(255,255,255,.06);
    }

    /* LEFT: Now Playing */
    .now{position:relative; padding:24px; background:linear-gradient(160deg, rgba(108,156,255,.15), rgba(169,108,255,.12));}
    .cover{
      width:100%; aspect-ratio:1/1; border-radius:16px; overflow:hidden;
      position:relative; box-shadow: 0 12px 30px rgba(0,0,0,.4);
      border:1px solid rgba(255,255,255,.06);
    }
    .cover img{width:100%; height:100%; object-fit:cover; display:block; filter: saturate(1.1) contrast(1.05)}

    .floating-glow{
      position:absolute; inset:auto auto -30px -30px; width:180px; height:180px;
      background: radial-gradient(circle at 30% 30%, var(--brand), transparent 60%);
      filter: blur(30px); opacity:.35; pointer-events:none; transform:rotate(15deg);
    }

    .meta{margin-top:18px}
    .title{font-size:1.4rem; font-weight:700; line-height:1.2}
    .artist{color:var(--muted); margin-top:6px}

    .badges{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}
    .badge{
      font-size:.75rem; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05); color:var(--text); user-select:none;
    }

    .viz{
      margin-top:18px; background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);
      border-radius:12px; overflow:hidden; height:80px;
    }
    canvas{display:block; width:100%; height:100%}

    /* RIGHT: Controls + Playlist */
    .right{display:grid; grid-template-rows:auto 1fr auto; padding:24px; gap:18px}

    .controls{
      background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:16px; display:grid; gap:12px;
    }

    .time-row{display:flex; align-items:center; justify-content:space-between; font-variant-numeric: tabular-nums}
    .progress{position:relative; height:10px; background:rgba(255,255,255,.06); border-radius:999px; overflow:hidden; cursor:pointer}
    .progress-fill{position:absolute; inset:0 auto 0 0; width:0%; background: linear-gradient(90deg, var(--brand), var(--brand-2));}
    .progress-handle{position:absolute; top:50%; transform:translate(-50%,-50%); width:16px; height:16px; border-radius:50%; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.4); left:0%;}

    .buttons{display:flex; align-items:center; gap:10px; justify-content:center}
    .btn{
      appearance:none; border:none; padding:12px; border-radius:14px; cursor:pointer; color:var(--text);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.12); box-shadow: inset 0 1px 0 rgba(255,255,255,.1), var(--shadow);
      transition: transform .15s ease, box-shadow .2s ease, background .3s ease;
    }
    .btn:hover{transform:translateY(-2px)}
    .btn:active{transform:translateY(0) scale(.98)}

    .btn.main{
      padding:16px 18px; border-radius:16px; font-weight:700;
      background: linear-gradient(180deg, var(--brand), var(--brand-2));
      color:#0b1020; text-shadow: 0 1px 0 rgba(255,255,255,.2);
    }

    .toggles{display:flex; gap:10px; justify-content:center}
    .toggle{
      display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04); font-size:.85rem; cursor:pointer; user-select:none;
    }
    .dot{width:10px; height:10px; border-radius:50%; background: rgba(255,255,255,.25); transition: background .2s ease}
    .toggle.on .dot{background: var(--success)}

    .sliders{display:flex; align-items:center; gap:14px; justify-content:space-between}
    .vol{display:flex; align-items:center; gap:10px; flex:1}
    input[type="range"]{width:100%; accent-color:var(--brand)}

    /* Playlist */
    .playlist{
      background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; overflow:hidden; position:relative; display:flex; flex-direction:column;
    }
    .playlist header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.06)}
    .playlist ul{list-style:none; margin:0; padding:0; max-height:260px; overflow:auto}
    .playlist li{display:grid; grid-template-columns: 46px 1fr auto; gap:12px; align-items:center; padding:10px 12px; cursor:pointer; transition: background .2s}
    .playlist li:hover{background: rgba(255,255,255,.05)}
    .playlist li.active{background: linear-gradient(90deg, rgba(108,156,255,.18), rgba(169,108,255,.18));}
    .thumb{width:46px; height:46px; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
    .thumb img{width:100%; height:100%; object-fit:cover}
    .li-title{font-weight:600}
    .li-artist{color:var(--muted); font-size:.85rem}

    .footer{
      display:flex; align-items:center; justify-content:space-between; gap:10px; font-size:.9rem; color:var(--muted)
    }

    /* Keyframe pizzazz */
    @keyframes pulse {
      0%{transform:scale(1); box-shadow:0 0 0 0 rgba(108,156,255,.5)}
      70%{transform:scale(1.02); box-shadow:0 0 0 14px rgba(108,156,255,0)}
      100%{transform:scale(1)}
    }
    .playing .btn.main{animation: pulse 1.8s ease-out infinite}

    /* Responsive */
    @media (max-width: 800px){
      .player{grid-template-columns: 1fr}
      .now{order:1}
      .right{order:2}
    }
  </style>
</head>
<body>
  <div class="player" id="player">
    <!-- LEFT -->
    <section class="now">
      <div class="cover">
        <img id="cover" alt="Album cover" src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=800&auto=format&fit=crop" />
        <div class="floating-glow" aria-hidden="true"></div>
      </div>
      <div class="meta">
        <div class="title" id="title">‚Äî</div>
        <div class="artist" id="artist">‚Äî</div>
        <div class="badges">
          <span class="badge" id="badge-index">Track 1 / 1</span>
          <span class="badge" id="badge-mode">Repeat: Off</span>
          <span class="badge" id="badge-autoplay">Autoplay: On</span>
        </div>
      </div>
      <div class="viz"><canvas id="visualizer" height="80"></canvas></div>
    </section>

    <!-- RIGHT -->
    <section class="right">
      <div class="controls" id="controls">
        <div class="time-row">
          <span id="current">0:00</span>
          <span id="duration">0:00</span>
        </div>
        <div class="progress" id="progress" aria-label="Seek">
          <div class="progress-fill" id="progressFill"></div>
          <div class="progress-handle" id="progressHandle" aria-hidden="true"></div>
        </div>
        <div class="buttons">
          <button class="btn" id="btnShuffle" title="Shuffle">üîÄ</button>
          <button class="btn" id="btnPrev" title="Previous">‚èÆÔ∏è</button>
          <button class="btn main" id="btnPlay" title="Play/Pause">‚ñ∂Ô∏è</button>
          <button class="btn" id="btnNext" title="Next">‚è≠Ô∏è</button>
          <button class="btn" id="btnRepeat" title="Repeat mode (Off ‚ñ∂ All ‚ñ∂ One)">üîÅ</button>
        </div>
        <div class="toggles">
          <div class="toggle on" id="tgAutoplay" role="switch" aria-checked="true"><span class="dot"></span> Autoplay</div>
          <div class="toggle" id="tgMute" role="switch" aria-checked="false"><span class="dot"></span> Mute</div>
        </div>
        <div class="sliders">
          <div class="vol">
            <span>üîä</span>
            <input id="volume" type="range" min="0" max="1" step="0.01" value="0.9" />
          </div>
        </div>
      </div>

      <div class="playlist">
        <header>
          <strong>Playlist</strong>
          <button class="btn" id="btnClear">üóëÔ∏è Clear (demo)</button>
        </header>
        <ul id="list"></ul>
      </div>

      <div class="footer">
        <span>Tip: Drop your MP3 files anywhere on this page to add them to the playlist.</span>
        <span id="status">Ready</span>
      </div>
    </section>
  </div>

  <!-- Hidden audio element -->
  <audio id="audio" crossorigin="anonymous"></audio>

  <script>
    // ======= Configuration / Demo Tracks =======
    // Replace these with your own files. Local paths like "audio/song1.mp3" also work.
    const demoTracks = [
      {
        title: "devil",
        artist: "City Skyline",
        src: "the-devilx27s-entry-143138.mp3",
        cover: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=800&auto=format&fit=crop"
      },
      {
        title: "Gentle Morning",
        artist: "Lo-Fi Garden",
        src: "tell-me-what-379638.mp3",
        cover: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=800&auto=format&fit=crop"
      },
      {
        title: "Night Runner",
        artist: "Neon Highway",
        src: "vlog-beat-background-349853.mp3",
        cover: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=800&auto=format&fit=crop"
      }
    ];

    // ======= Elements =======
    const audio = document.getElementById('audio');
    const titleEl = document.getElementById('title');
    const artistEl = document.getElementById('artist');
    const coverEl = document.getElementById('cover');
    const badgeIndex = document.getElementById('badge-index');
    const badgeMode = document.getElementById('badge-mode');
    const badgeAutoplay = document.getElementById('badge-autoplay');

    const currentEl = document.getElementById('current');
    const durationEl = document.getElementById('duration');
    const progress = document.getElementById('progress');
    const progressFill = document.getElementById('progressFill');
    const progressHandle = document.getElementById('progressHandle');

    const btnPlay = document.getElementById('btnPlay');
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    const btnShuffle = document.getElementById('btnShuffle');
    const btnRepeat = document.getElementById('btnRepeat');

    const tgAutoplay = document.getElementById('tgAutoplay');
    const tgMute = document.getElementById('tgMute');
    const volume = document.getElementById('volume');

    const list = document.getElementById('list');
    const btnClear = document.getElementById('btnClear');
    const statusEl = document.getElementById('status');
    const playerRoot = document.getElementById('player');

    // ======= State =======
    let tracks = [...demoTracks];
    let order = [...tracks.keys()]; // playback order
    let index = 0;
    let isPlaying = false;
    let repeatMode = 0; // 0: off, 1: all, 2: one
    let shuffle = false;
    let autoplay = true; // auto-advance to next track

    // ======= Helpers =======
    const fmt = (sec) => {
      if (!isFinite(sec)) return '0:00';
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60).toString().padStart(2,'0');
      return `${m}:${s}`;
    };

    function setStatus(text){
      statusEl.textContent = text;
    }

    function updateBadges(){
      badgeIndex.textContent = `Track ${index+1} / ${tracks.length}`;
      badgeMode.textContent = `Repeat: ${['Off','All','One'][repeatMode]}`;
      badgeAutoplay.textContent = `Autoplay: ${autoplay? 'On':'Off'}`;
    }

    function buildPlaylist(){
      list.innerHTML = '';
      tracks.forEach((t,i)=>{
        const li = document.createElement('li');
        li.dataset.i = i;
        if (order[index] === i) li.classList.add('active');
        li.innerHTML = `
          <div class="thumb"><img src="${t.cover}" alt="cover"/></div>
          <div>
            <div class="li-title">${t.title}</div>
            <div class="li-artist">${t.artist}</div>
          </div>
          <div class="li-duration" id="dur-${i}">--:--</div>
        `;
        li.addEventListener('click', ()=>{ loadByOriginalIndex(i, true); });
        list.appendChild(li);
      });
      // Preload durations silently
      tracks.forEach((t,i)=>{
        const a = new Audio(); a.src = t.src; a.preload = 'metadata';
        a.addEventListener('loadedmetadata', ()=>{
          const el = document.getElementById(`dur-${i}`);
          if (el) el.textContent = fmt(a.duration);
        });
      });
    }

    function shuffleArray(arr){
      for (let i = arr.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }

    function applyShuffle(){
      if (shuffle){
        const curOriginal = order[index];
        order = [...tracks.keys()];
        shuffleArray(order);
        // Keep current track at current position
        const pos = order.indexOf(curOriginal);
        [order[0], order[pos]] = [order[pos], order[0]];
        index = 0;
      } else {
        const currentOriginal = order[index];
        order = [...tracks.keys()];
        index = order.indexOf(currentOriginal);
      }
      buildPlaylist();
      highlightActive();
    }

    function highlightActive(){
      [...list.children].forEach(li=>li.classList.remove('active'))
      const activeOriginal = order[index];
      const li = [...list.children].find(el=>Number(el.dataset.i)===activeOriginal);
      if (li) li.classList.add('active');
    }

    function loadByOrder(i, autoplayNow=false){
      index = (i+order.length) % order.length;
      const t = tracks[order[index]];
      audio.src = t.src;
      titleEl.textContent = t.title;
      artistEl.textContent = t.artist;
      coverEl.src = t.cover;
      updateBadges();
      highlightActive();
      setStatus('Loading‚Ä¶');
      audio.load();
      if (autoplayNow) play(); else pause();
    }

    function loadByOriginalIndex(originalIndex, autoplayNow=false){
      index = order.indexOf(originalIndex);
      if (index === -1) index = 0;
      loadByOrder(index, autoplayNow);
    }

    function play(){ audio.play().then(()=>{ isPlaying = true; btnPlay.textContent = '‚è∏Ô∏è'; playerRoot.classList.add('playing'); setStatus('Playing'); }).catch(err=>{ setStatus('Play blocked: '+err.message); }); }
    function pause(){ audio.pause(); isPlaying = false; btnPlay.textContent = '‚ñ∂Ô∏è'; playerRoot.classList.remove('playing'); setStatus('Paused'); }

    function next(){
      if (repeatMode === 2) return loadByOrder(index, true); // repeat one
      let n = index + 1;
      if (n >= order.length){ n = (repeatMode===1) ? 0 : order.length-1; }
      loadByOrder(n, true);
    }

    function prev(){
      if (audio.currentTime > 2) { audio.currentTime = 0; return; }
      let p = index - 1;
      if (p < 0){ p = (repeatMode===1) ? order.length-1 : 0; }
      loadByOrder(p, true);
    }

    // ======= Events =======
    btnPlay.addEventListener('click', ()=> isPlaying? pause() : play());
    btnNext.addEventListener('click', next);
    btnPrev.addEventListener('click', prev);

    btnShuffle.addEventListener('click', ()=>{ shuffle = !shuffle; btnShuffle.classList.toggle('main', shuffle); setStatus(shuffle? 'Shuffle On':'Shuffle Off'); applyShuffle(); });
    btnRepeat.addEventListener('click', ()=>{ repeatMode = (repeatMode+1)%3; btnRepeat.classList.toggle('main', repeatMode>0); updateBadges(); setStatus(['Repeat Off','Repeat All','Repeat One'][repeatMode]); });

    tgAutoplay.addEventListener('click', ()=>{ autoplay = !autoplay; tgAutoplay.classList.toggle('on', autoplay); tgAutoplay.setAttribute('aria-checked', String(autoplay)); updateBadges(); });
    tgMute.addEventListener('click', ()=>{ audio.muted = !audio.muted; tgMute.classList.toggle('on', audio.muted); tgMute.setAttribute('aria-checked', String(audio.muted)); });

    volume.addEventListener('input', ()=>{ audio.volume = volume.value; if (audio.volume===0 && !audio.muted) { audio.muted = true; tgMute.classList.add('on'); } else if (audio.volume>0 && audio.muted){ audio.muted = false; tgMute.classList.remove('on'); }});

    audio.addEventListener('timeupdate', ()=>{
      const {currentTime, duration} = audio;
      const pct = duration ? (currentTime/duration)*100 : 0;
      progressFill.style.width = pct + '%';
      progressHandle.style.left = pct + '%';
      currentEl.textContent = fmt(currentTime);
      durationEl.textContent = fmt(duration);
    });

    audio.addEventListener('loadedmetadata', ()=>{
      durationEl.textContent = fmt(audio.duration);
    });

    audio.addEventListener('ended', ()=>{
      if (autoplay){
        if (repeatMode===2){ loadByOrder(index, true); }
        else if (index < order.length-1){ loadByOrder(index+1, true); }
        else if (repeatMode===1){ loadByOrder(0, true); }
        else { pause(); }
      } else {
        pause();
      }
    });

    // Seek by clicking the progress bar
    function seekAt(clientX){
      const rect = progress.getBoundingClientRect();
      const pct = Math.min(Math.max(0, clientX - rect.left), rect.width) / rect.width;
      audio.currentTime = (audio.duration || 0) * pct;
    }
    progress.addEventListener('click', (e)=> seekAt(e.clientX));

    // Drag handle
    let dragging = false;
    progress.addEventListener('pointerdown', (e)=>{ dragging = true; progress.setPointerCapture(e.pointerId); seekAt(e.clientX); });
    progress.addEventListener('pointermove', (e)=>{ if (dragging) seekAt(e.clientX); });
    progress.addEventListener('pointerup', (e)=>{ dragging = false; progress.releasePointerCapture(e.pointerId); });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if (['INPUT','TEXTAREA'].includes((e.target.tagName))) return;
      if (e.code==='Space'){ e.preventDefault(); isPlaying? pause() : play(); }
      if (e.code==='ArrowRight'){ audio.currentTime = Math.min(audio.duration||0, audio.currentTime + 5); }
      if (e.code==='ArrowLeft'){ audio.currentTime = Math.max(0, audio.currentTime - 5); }
      if (e.code==='ArrowUp'){ volume.value = Math.min(1, Number(volume.value)+0.05); volume.dispatchEvent(new Event('input')); }
      if (e.code==='ArrowDown'){ volume.value = Math.max(0, Number(volume.value)-0.05); volume.dispatchEvent(new Event('input')); }
      if (e.key.toLowerCase()==='n'){ next(); }
      if (e.key.toLowerCase()==='p'){ prev(); }
      if (e.key.toLowerCase()==='s'){ shuffle = !shuffle; btnShuffle.click(); }
      if (e.key.toLowerCase()==='r'){ btnRepeat.click(); }
    });

    // Drag & drop to add files
    window.addEventListener('dragover', e=>{ e.preventDefault(); setStatus('Drop to add to playlist'); });
    window.addEventListener('dragleave', ()=> setStatus('Ready'));
    window.addEventListener('drop', async (e)=>{
      e.preventDefault();
      const files = [...e.dataTransfer.files].filter(f=> f.type.startsWith('audio/'));
      if (!files.length) return setStatus('No audio files detected');
      for (const f of files){
        const url = URL.createObjectURL(f);
        tracks.push({ title: f.name.replace(/\.[^/.]+$/,''), artist: 'Local file', src: url, cover: coverEl.src });
      }
      order = [...tracks.keys()];
      buildPlaylist();
      setStatus(files.length + ' tracks added');
      updateBadges();
    });

    btnClear.addEventListener('click', ()=>{
      tracks = [];
      order = [];
      list.innerHTML = '';
      pause();
      audio.removeAttribute('src');
      titleEl.textContent = '‚Äî';
      artistEl.textContent = '‚Äî';
      currentEl.textContent = '0:00';
      durationEl.textContent = '0:00';
      badgeIndex.textContent = 'Track 0 / 0';
      setStatus('Playlist cleared (demo)');
    });

    // ======= Visualizer (Web Audio API) =======
    let ctx, analyser, source, dataArray;
    const canvas = document.getElementById('visualizer');
    const c = canvas.getContext('2d');

    function createAudioGraph(){
      if (ctx) return;
      ctx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = ctx.createAnalyser();
      analyser.fftSize = 256;
      dataArray = new Uint8Array(analyser.frequencyBinCount);
      source = ctx.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(ctx.destination);
    }

    function drawViz(){
      if (!analyser) return requestAnimationFrame(drawViz);
      const { width, height } = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.floor(width * dpr);
      canvas.height = Math.floor(height * dpr);
      c.scale(dpr, dpr);

      c.clearRect(0,0,width,height);
      analyser.getByteFrequencyData(dataArray);

      const bars = 48;
      const step = Math.floor(dataArray.length / bars);
      const barWidth = width / bars;
      for (let i=0;i<bars;i++){
        const v = dataArray[i*step]/255; // 0..1
        const h = v * (height-6);
        const x = i*barWidth + 2;
        const y = height - h - 2;
        // gradient per bar
        const grd = c.createLinearGradient(0,y,0,y+h);
        grd.addColorStop(0, '#6c9cff');
        grd.addColorStop(1, '#a96cff');
        c.fillStyle = grd;
        const radius = 6; // rounded bars
        const w = barWidth - 4;
        roundRect(c, x, y, w, h, radius);
        c.fill();
      }
      requestAnimationFrame(drawViz);
    }

    function roundRect(ctx, x, y, w, h, r){
      if (w<2*r) r = w/2; if (h<2*r) r = h/2;
      ctx.beginPath();
      ctx.moveTo(x+r,y);
      ctx.arcTo(x+w,y,x+w,y+h,r);
      ctx.arcTo(x+w,y+h,x,y+h,r);
      ctx.arcTo(x,y+h,x,y,r);
      ctx.arcTo(x,y,x+w,y,r);
      ctx.closePath();
    }

    // ======= Init =======
    function init(){
      buildPlaylist();
      applyShuffle(); // keeps order but ensures setup
      loadByOrder(0, false);
      updateBadges();
      createAudioGraph();
      drawViz();

      // Start context on first user interaction (autoplay policies)
      const resume = ()=>{ if (ctx && ctx.state === 'suspended') ctx.resume(); window.removeEventListener('click', resume); };
      window.addEventListener('click', resume, { once:true });
    }

    init();
  </script>
</body>
</html>